<!DOCTYPE html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registered Barangays</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <link rel="stylesheet" href="{% static 'css/barangay_list.css' %}">
</head>
<body>
  <!-- Top Navigation -->
  <div class="container-fluid px-3">
    <div class="topbar rounded d-flex align-items-center">
      <button class="rtn-btn me-3" onclick="location.href='/admin-dashboard'"> 
        <div class="button-box">
          <span class="button-elem">
            <svg viewBox="0 0 46 40" xmlns="http://www.w3.org/2000/svg">
              <path d="M46 20.038c0-.7-.3-1.5-.8-2.1l-16-17c-1.1-1-3.2-1.4-4.4-.3-1.2 1.1-1.2 3.3 0 4.4l11.3 11.9H3c-1.7 0-3 1.3-3 3s1.3 3 3 3h33.1l-11.3 11.9c-1 1-1.2 3.3 0 4.4 1.2 1.1 3.3.8 4.4-.3l16-17c.5-.5.8-1.1.8-1.9z"></path>
            </svg>
          </span>
        </div>
      </button>
      <div class="logo-title fw-bold">PPMS CLUSTER 4 IMUS CITY</div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container-fluid px-3 mt-3">
    <div class="main-container">
      <h2 class="text-center">Registered Barangays</h2>

      <!-- Stats -->
      <div class="stats-info text-center mb-3">

      </div>

      <!-- Search -->
      <div class="row mb-4">
        <div class="col-lg-6 col-md-8 col-sm-12 mx-auto">
          <div class="input-group">
            <input type="text" id="search-input" class="form-control search-input" placeholder="Search barangay...">
            <button id="search-btn" class="btn btn-custom" type="button">
              <i class="fas fa-search"></i>
            </button>
            <button id="clear-btn" class="btn btn-secondary" type="button">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Table -->
      <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover align-middle">
          <thead class="table-light text-center">
            <tr>
              <th>Barangay Name</th>
              <th>Phone Number</th>
              <th>Hall Address</th>
              <th>Preschoolers</th>
              <th>Parents</th>
              <th>BHW/BNS</th>
            </tr>
          </thead>
          <tbody id="barangay-table">
            {% for b in barangays %}
            <tr class="barangay-row">
              <td><strong>{{ b.name }}</strong></td>
              <td>{{ b.phone_number|default:"N/A" }}</td>
              <td>{{ b.hall_address|default:"N/A" }}</td>
              <td class="text-center text-danger">{{ b.preschooler_count }}</td>
              <td class="text-center text-primary">{{ b.parent_count }}</td>
              <td class="text-center text-success">{{ b.bhw_bns_count }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center py-5 text-muted">
                <i class="fas fa-inbox fa-3x mb-3"></i>
                <p>No barangays registered yet.</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- No Results Message -->
      <div id="no-results" class="text-center text-muted mt-3" style="display:none;">
        <i class="fas fa-search mb-2"></i>
        <p>No barangays found.</p>
      </div>

      <!-- Pagination -->
      {% if barangays.paginator.num_pages > 1 %}
      <nav class="pagination-custom text-center mt-4" aria-label="Page navigation">
        <ul class="pagination justify-content-center">
          {% if barangays.has_previous %}
          <li class="page-item">
            <a class="btn btn-custom" href="?page={{ barangays.previous_page_number }}">
              <i class="fas fa-chevron-left"></i> Previous
            </a>
          </li>
          {% endif %}

          <li class="page-item disabled">
            <span class="page-link bg-transparent border-0">
              Page {{ barangays.number }} of {{ barangays.paginator.num_pages }}
            </span>
          </li>

          {% if barangays.has_next %}
          <li class="page-item">
            <a class="btn btn-custom" href="?page={{ barangays.next_page_number }}">
              Next <i class="fas fa-chevron-right"></i>
            </a>
          </li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    </div>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const searchInput = document.getElementById("search-input");
      const searchBtn = document.getElementById("search-btn");
      const clearBtn = document.getElementById("clear-btn");
      const rows = document.querySelectorAll(".barangay-row");
      const noResults = document.getElementById("no-results");

      function performSearch() {
        const input = searchInput.value.toLowerCase().trim();
        let visibleCount = 0;

        rows.forEach(row => {
          const rowText = row.textContent.toLowerCase();
          if (rowText.includes(input)) {
            row.style.display = "";
            visibleCount++;
          } else {
            row.style.display = "none";
          }
        });

        noResults.style.display = visibleCount === 0 && input !== "" ? "block" : "none";
      }

      function clearSearch() {
        searchInput.value = "";
        rows.forEach(row => row.style.display = "");
        noResults.style.display = "none";
      }

      searchBtn.addEventListener("click", performSearch);
      clearBtn.addEventListener("click", clearSearch);
      searchInput.addEventListener("input", performSearch);
      searchInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") performSearch();
      });
    });
  </script>
</body>
</html>
